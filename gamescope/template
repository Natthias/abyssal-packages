# Template file for 'gamescope'
pkgname=gamescope
version=3.12.5
revision=1
_stb_commit=5736b15f7ea0ffb08dd38af21067c314d6a3aae9 # latest commit before release of 3.12.0
_vkroots_commit=26757103dde8133bab432d172b8841df6bb48155
build_wrksrc="${pkgname}-${version}"
build_style=meson
configure_args="-Dforce_fallback_for='' -Dpipewire=enabled"
depends="xorg-server-xwayland"
hostmakedepends="pkg-config glslang wayland-devel cmake"
makedepends="libX11-devel libXdamage-devel libXcomposite-devel hwids
 libXrender-devel libXxf86vm-devel libXtst-devel libXres-devel libdrm-devel
 vulkan-loader wayland-protocols libxkbcommon-devel libcap-devel glm
 SDL2-devel wlroots-devel libseat-devel libliftoff-devel openvr-devel
 libXmu-devel libdisplay-info-devel benchmark-devel"
short_desc="micro-compositor formerly known as steamcompmgr"
maintainer="Natthias <natthias@proton.me>"
license="BSD-2-Clause"
homepage="https://github.com/ValveSoftware/gamescope"
distfiles="https://github.com/ValveSoftware/gamescope/archive/refs/tags/${version}.tar.gz
 https://github.com/nothings/stb/archive/${_stb_commit}.tar.gz
 https://github.com/Joshua-Ashton/vkroots/archive/${_vkroots_commit}.tar.gz"
checksum="32a020e35b8443862c900306fb6edb84a8ecb009c89184d2062b0b8ce2811e17
 d00921d49b06af62aa6bfb97c1b136bec661dd11dd4eecbcb0da1f6da7cedb4c
 adf158c3da572f1dfaa6e1a7a51943aafb824222e77f512a4666472d71321244"
patch_args="-Np1 -d $build_wrksrc"

post_extract() {
	mv stb-${_stb_commit} ${build_wrksrc}/subprojects/stb
	mv ${build_wrksrc}/subprojects/packagefiles/stb/meson.build ${build_wrksrc}/subprojects/stb
	rmdir ${build_wrksrc}/subprojects/packagefiles/stb ${build_wrksrc}/subprojects/packagefiles
        
	rmdir ${build_wrksrc}/subprojects/vkroots
	mv vkroots-${_vkroots_commit} ${build_wrksrc}/subprojects/vkroots
}
